<style>
nav.no-bullet > ul {
  list-style-type: none;
}
</style>

# HTTP

## URI
HTTP relies on the Uniform Resource Identifier (URI) standard for requesting target resource. A URI can be classified as a locator(URL), a name(URN), or both. 

In addition to identify the resource, URL also specify the location of the resource by specifying the access mechanism (e.g. network location)

Example
- URL: *http://www.ietf.org/rfc/rfc2396.txt*
- URN: *urn:oasis:names:specification:docbook:dtd:xml:4.1.2*

![URI, URL and URN](img/uri-url-urn.png)

See:
- [RFC-3986 URI](https://tools.ietf.org/html/rfc3986)

## Messaging
### Client request
![Sample Request](img/http-request.png)
Status line format
```
request-method resource-URI http-versions
```

header format
```
header-name: val1, val2, ...
```
### Server response
![Sample Response](img/http-response.png)


## HTTP methods
### OPTIONS
### GET
#### Conditional GET semantics
When request messages include the applicable headers, the semantics of GET method changes to a 'conditional GET': 
- If-Modified-Since 
- If-Unmodified-Since
- If-Match 
- If-None-Match
- If-Range
The GET will only be performed if the conditions are met. This is used to reduce network usage.

#### Partial GET semantics
#### Cachablity

## Common HTTP headers

### Cache-Control
holds instructions for caching in both request and response.

#### Directives
Cacheability
- **`public`**: resposne may be cached by any cache
- **`private`**: the response is for a single user and should not be cached in a shared cache. A private cache may store the response.
- **`no-cache`**: caches must re-validate with origin server before using the cached copy. (importhat to note that no-cache DOES NOT mean do not cache anything)
- **`no-store`**: the cache should not store anything about the request or response.
Expiration
- **`max-age=\<seconds\>`**: The maximum amount of time a resource is considered fresh. This is relative to the time of the request (unlike the `Expires` header which uses absolute date time).
- **`s-maxage=\<seconds\>`**: overrides the `max-age` or the `Expires` header for sshared caches. Ignored by private caches.
- **`max-stale[=\<seconds\>]`**: indicates the client will accept a stale response. Optional value indicates the maximum staleness that client can accept.
- **`min-fresh=\<seconds\>`**: Indicates the client wants a response that will still be fresh for at least the specified number of seconds. 
- **`no-transform`**: 
- **`only-if-cached`**: 

some other
- `must-revalidate`
- `no-transform`
- `proxy-revalidate`
- ...
### Accept
### Accept-Language
### Host
### If-Modified-Since
```
If-Modified-Since: <http-date>
```
Makes the request conditional:
- Server will send `200` response with requested resource, only if it has been last modified after the given date. 
- Otherwise, sever send `304` response without any body; 

The date value comes from the `Last-Modified` response header of a previous request.

### ETag
ETag response header is an identifier for a specific version of a resource. 

```
ETag: W/"<etag_value>"
ETag: "<etag_value>"
```
`W/` indicates using a weak validator. The etag value is generated by the server to uniquely represent the resource. It's usually a hash of the content.

Etag is used to validate cached response with server.

### Referer
`Referer: <url>` indicates the previous web page linking to current page. Can be used in analytics to identify where user are visiting from.

### Connection
Controls whether or not the network connection stays open after the current trasaction finishes. If the value send is `keep-alive`, the connection is persistent, allowing subsequent requests.

Can be used together with the `Keep-Alive` header
```
Connection: keep-alive
Keep-Alive: timeout=5, max=1000 
```

> Connection-specifit headers MUST NOT be used in HTTP/2

## Status codes

### 3XX Redirection Messages
This class of status code indicates that further action needs to be taken by the **user agent** in order to fufill the request. The action required MAY be carried out by the user agent without interaction with the user if and only if the method used **in the second request** is GET or HEAD. 

<nav class="no-bullet">

**301 Moved Permanently**
- Indicates that the URI of the requested resource has been changed permanently. Any future references to this resource should use the new permanent URI. The new permanent URI should be given in the Location field in response.

**302 Found**
- Indicates that the URI of the requested resource has been changed *temporarily*. 

**307 Temporary Redirect**
- Same semantics as `302 Found`, except that the user agent must not change the HTTP method used in the following requests.

**308 Permanent Redirect**
- Same semantics as `301 Moved`, except that the user agent must not change the HTTP method used in the following requests.
</nav>

## HTTP 1.1 over HTTP 1.0
### Caching
### Persistent Connection

# HTTPS

## SSL
SSL was the previous protocol, including SSL1.0, 2.0 and 3.0. Now deprecated and insecure.

## Transport Layer Security (TLS)
Built on top of SSL 3.0

### TLS Handshake
On top of the normal 3-way TCP handshake, additional information is needed to negotiate the encrypted tunnel. Client and server need to agree on the version of TLS protocol, the ciphersuite and verify certificate etc.

TLS handshake added more round trip times (below is just for example): 
1. S: SYN
2. R: SYN ACK
3. S: SYN + ClientHello
4. R: ServerHello + Certificate + ServerHelloDone
5. S: ClientKeyExchange + ChangeCipherSpec + Finished
6. R: ChangeCipherSpec + Finished 
7. (secure tunnel established...) 
(S - Sender, R - Receiver)

## Asymmetric encryption + Symmetric encryption

The reason why we need to use a combination of asymmetric and symmetric is that, **asymmetric encryption are often slow and not used for encrpyting large amount of data**. So we still use the symmetric key to encrypt the message, but on top of that, we use asymmetric encryption to encrypt the symmetric key.

## Digital Certificate
### X.509
In cryptography, X.509 is the standard defining the format of **public key certificate**. X.509 is used in TLS/SSL, which is the basis for HTTPS. They can also be used for offline applications such as electronic signatures.

The reason we need certificate is that we can **make sure that the public key is from the trusted source**. 

### Certificate path validation algorithm
X.509 defines a certificate path validation alogrithm, which allows a certificate to be signed by intermediate CA certificates, which are, in turn, signed by other certificate, eventually reaching a **trust anchor**. 

The alogrithm can verify a given certificate path from the subject certificate leading up to a trusted root certificate.

# HTTP/2

## Byte framing layer
*This is the foundational design change for http/2 over http/1.x

HTTP/2 introduced a new optimized binary ecoding mechanism. The logical content of http message is not affected (verb, headers, etc). A message is encoded into one or more frames. Each frame contains frame header to identify the stream which it belongs to.

- Stream: a bidirectional flow of bytes within an established connection, which may carray one or more messages.

Byte framing is the fundation that enables all other features and performance optimizations.

## Multiplexing
For HTTP/2 all communications is performed over a single TCP connection (**per origin**). As a result of using byte framing layer, client/server breaks down a HTTP message into indenpendent frames, which can be interleaved, and later reassemble them on the recieving end.

the ability to interleave and re-asseble frames provides multiple benefits:
- interleave multiple requests (or responses) without blocking any one
- deliver multiple requests in parallel
- improve utilization of available network

## Stream prioritization
Http/2 allows each stream to have associated weight and explicit dependency on another stream. Client and construct and communicate a 'prioritization tree' to express how it would prefer to receive responses. In turn server can use the info to prioritize resources.

Note this is an expression of preference, it doesn't gurantee the processing and transmission.

## One connection per origin
With the binary framing mechanism enalbing multiplexing, HTTP/2 connections are persistent and only one connection is required per origin.

The benefits are obvious:
- reduce network latency by reducing the overhead of multiple TCP/TLS handshakes.
- increase throughput/network capacity, as intermediaries/servers handles fewer connections per client.

## Flow control
HTTP/2 provide a mechanism to intialize and update the window size via SETTINGS / DATA / WINDOW_UPDATE frame.

The implementation of flow control is leave to the client/server.

## Server push
Server push allows server to send multiple response for a single request. This allows server to push additional resources to client without the client having to request explicitly.

> **this mechanism opens up many opportunities

## Header compression

### HPACK
### static / dynamic table


