<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/cs-notes/styles.7f67dccd6da6a9c0ed60.css">code[class*=language-],pre[class*=language-]{color:#000;background:none;text-shadow:0 1px #fff;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.grds-color{flex-basis:300px!important;max-width:300px!important}.grds-wrapper{color:#000;margin-bottom:24px}@media (max-width:700px){.grds-wrapper{flex-basis:100%!important;max-width:100%!important;margin:0 0 24px}}.grds-audio{margin-right:10px}.grds-audio__container{background:#f4f6f8;padding:20px;border-radius:10px;width:100%}.grds-audio__title{margin-bottom:1rem;display:flex;align-items:center}.grds-audio__title svg{height:25px;width:25px;fill:#48ba6f;margin-right:1.5rem}.grds-audio__audiofile{width:100%}.grds-color{display:inline-block!important;margin-right:10px}@media (max-width:700px){.grds-color{display:block!important}}.grds-color__container{border-radius:10px;width:300px;display:flex;flex-direction:column}@media (max-width:700px){.grds-color__container{width:100%}}.grds-color__swatch{height:150px;border-radius:10px 10px 0 0;position:relative;display:flex;align-items:flex-end;padding-bottom:10px;justify-content:center}.grds-color__swatch__a11y{display:flex;flex-direction:column;width:50px;margin:0 3px}.grds-color__swatch__a11y__char{color:#fff;text-align:center}.grds-color__swatch__a11y__status{color:#fff;background:#000;padding:2px 5px;display:inline-block;border-radius:5px;font-size:.9rem;text-align:center}.grds-color__info{display:flex;flex-wrap:wrap;padding:10px;background:#f4f6f8;border-radius:0 0 10px 10px}.grds-color__info__item{margin-bottom:1rem;margin-top:.5rem;flex-basis:50%}.grds-color__info__item .clippy{display:inline-block}.grds-color__info__item p:first-child{text-transform:uppercase;color:#7d858c;font-size:.75rem}.grds-color__info__item p{margin-bottom:.25rem;margin-top:.5rem}.grds-color-palette__container{background:#f4f6f8;border-radius:10px;width:100%}.grds-color-palette__item{padding:20px;border-bottom:2px solid #c5d3e0;display:flex;justify-content:space-between;flex-wrap:wrap}.grds-color-palette__item:last-child{border-bottom:none}.grds-color-palette__left,.grds-color-palette__right{display:flex;align-items:center;flex-wrap:wrap}.grds-color-palette__item__swatch{width:50px;height:50px;border-radius:10px;margin-right:20px;margin-top:10px;margin-bottom:10px}.grds-color-palette__item__name{padding:.5rem 1rem .5rem 0}.grds-color-palette__item__color:first-child{width:115px}.grds-color-palette__item__color{margin:.4rem 0;width:140px}.grds-color-palette__item__color span:first-child{background:#c5d3e0;color:#2e2e2e;padding:3px 5px;font-size:.7rem;border-radius:5px}.grds-color-palette__item__color span:last-child{margin-left:.25rem;font-size:.9rem}.grds-download{margin-right:10px}.grds-download__container{background:#f4f6f8;padding:20px;border-radius:10px;width:100%;text-decoration:none}.grds-download__info{justify-content:space-between}.grds-download__info,.grds-download__info__left{display:flex;align-items:center}.grds-download__info__left svg{height:25px;width:25px;fill:#48ba6f;margin-right:1.5rem}.grds-download__info__right{font-size:.75rem;color:#7d858c}.grds-download__preview{padding:20px;border-radius:10px;margin-top:40px;display:flex;justify-content:center;box-shadow:0 5px 15px rgba(0,0,0,.1)}.grds-download__image{-o-object-fit:cover;object-fit:cover;height:100%;margin-bottom:0}.grds-example{border-radius:10px;border:1px solid #c5d3e0}.grds-example__container,.grds-hint{padding:20px}.grds-hint{border-radius:10px;background:#f4f6f8;color:#7a7d80;border:1px solid #d9eafa;width:100%}.grds-hint__directive{background:#ecfaea;color:#307c3f;border:1px solid #c0ebc8}.grds-hint__warning{background:#fef5f5;color:#c93a3c;border:1px solid #fcddde}.grds-typo__container{width:100%}.grds-typo__item{display:flex;flex-direction:column;border-bottom:2px solid #c5d3e0;padding-bottom:1rem;margin-bottom:2rem}.grds-typo__item__name{margin-bottom:1.5rem}.grds-typo__item__info{display:flex;flex-direction:row;flex-wrap:wrap;justify-content:flex-start;width:100%}.grds-typo__item__info p:first-child{text-transform:uppercase;font-size:.75rem;color:#7d858c;margin-bottom:0}.grds-typo__item__info p:last-child{margin-top:.5rem}.grds-typo__item__info__desc{margin-right:2rem}.grds-video{margin-right:10px}.grds-video__container{background:#f4f6f8;padding:20px;border-radius:10px;width:100%}.grds-video__title{margin-bottom:15px;display:flex;align-items:center}.grds-video__title svg{height:25px;width:25px;fill:#48ba6f;margin-right:1.5rem}.grds-video__videofile{width:100%}.clippy:hover{cursor:pointer}.tooltipped{position:relative}.tooltipped:after{z-index:1000000;padding:.1rem .3rem;font:normal normal 11px/1.5 sans-serif;-webkit-font-smoothing:subpixel-antialiased;color:#fff;text-align:center;text-shadow:none;text-transform:none;letter-spacing:normal;word-wrap:break-word;white-space:pre;content:attr(aria-label);background:#000;border-radius:3px}.tooltipped:after,.tooltipped:before{position:absolute;display:inline-block;text-decoration:none;pointer-events:none}.tooltipped:before{z-index:1000001;width:0;height:0;color:#000;content:"";border:6px solid transparent}.tooltipped-n:after{right:50%;bottom:100%;margin-bottom:6px}.tooltipped-n:before{top:-7px;right:50%;bottom:auto;margin-right:-6px;border-top-color:#000}.tooltipped-n:after{transform:translateX(50%)}.s11jhqd8{height:60px;width:100%;background-color:#639}.h2h01z2{margin:0;max-width:960px;padding:20px 1rem}.hkd2pf6{margin:0}.h6fgol{color:#fff;-webkit-text-decoration:none;text-decoration:none}.s1x3km3v{border-right:1px solid #d3d3d3;width:350px;height:100%;min-height:100%;padding:1rem}html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}#___gatsby,#gatsby-focus-wrapper,body,html{height:100%;width:100%;overflow:hidden}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:100%/1.5 georgia,serif;box-sizing:border-box;overflow-y:scroll}*,:after,:before{box-sizing:inherit}body{color:rgba(0,0,0,.8);font-family:georgia,serif;font-weight:400;word-wrap:break-word;-webkit-font-kerning:normal;font-kerning:normal;-ms-font-feature-settings:"kern","liga","clig","calt";font-feature-settings:"kern","liga","clig","calt"}img{max-width:100%;padding:0;margin:0 0 1.45rem}h1{font-size:2rem}h1,h2{padding:0;margin:0 0 1.45rem;color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h2{font-size:1.51572rem}h3{font-size:1.31951rem}h3,h4{padding:0;margin:0 0 1.45rem;color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h4{font-size:1rem}h5{font-size:.85028rem}h5,h6{padding:0;margin:0 0 1.45rem;color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h6{font-size:.78405rem}hgroup{padding:0;margin:0 0 1.45rem}ol,ul{padding:0;margin:0 0 1.45rem 1.45rem;list-style-position:outside;list-style-image:none}dd,dl,figure,p{padding:0;margin:0 0 1.45rem}pre{margin:0 0 1.45rem;font-size:.85rem;line-height:1.42;background:rgba(0,0,0,.04);border-radius:3px;overflow:auto;word-wrap:normal;padding:1.45rem}table{font-size:1rem;line-height:1.45rem;border-collapse:collapse;width:100%}fieldset,table{padding:0;margin:0 0 1.45rem}blockquote{padding:0;margin:0 1.45rem 1.45rem}form,iframe,noscript{padding:0;margin:0 0 1.45rem}hr{padding:0;margin:0 0 calc(1.45rem - 1px);background:rgba(0,0,0,.2);border:none;height:1px}address{padding:0;margin:0 0 1.45rem}b,dt,strong,th{font-weight:700}li{margin-bottom:.725rem}ol li,ul li{padding-left:0}li>ol,li>ul{margin-left:1.45rem;margin-bottom:.725rem;margin-top:.725rem}blockquote :last-child,li :last-child,p :last-child{margin-bottom:0}li>p{margin-bottom:.725rem}code,kbd,samp{font-size:.85rem;line-height:1.45rem}abbr,abbr[title],acronym{border-bottom:1px dotted rgba(0,0,0,.5);cursor:help}abbr[title]{text-decoration:none}td,th,thead{text-align:left}td,th{border-bottom:1px solid rgba(0,0,0,.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding:.725rem .96667rem calc(.725rem - 1px)}td:first-child,th:first-child{padding-left:0}td:last-child,th:last-child{padding-right:0}code,tt{background-color:rgba(0,0,0,.04);border-radius:3px;font-family:SFMono-Regular,Consolas,Roboto Mono,Droid Sans Mono,Liberation Mono,Menlo,Courier,monospace;padding:.2em 0}pre code{background:none;line-height:1.42}code:after,code:before,tt:after,tt:before{letter-spacing:-.2em;content:" "}pre code:after,pre code:before,pre tt:after,pre tt:before{content:""}@media only screen and (max-width:480px){html{font-size:100%}}.ggj4icz{display:grid;grid-template-columns:auto 1fr;grid-template-rows:auto 1fr;grid-template-areas:"header header" "sidebar main";min-height:100%;height:100%}.hug0csx{grid-area:header}.s1p3sm64{grid-area:sidebar}.m1dsv0mj{grid-area:main;overflow-y:scroll}.c1swtufw{padding:1.5rem;margin:0 auto;max-width:960px}</style><meta name="generator" content="Gatsby 2.20.35"/><title data-react-helmet="true"></title><link rel="icon" href="/cs-notes/favicon-32x32.png?v=edf3d310d67f8284a562bc3a58c3e761"/><link rel="manifest" href="/cs-notes/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/cs-notes/icons/icon-48x48.png?v=edf3d310d67f8284a562bc3a58c3e761"/><link rel="apple-touch-icon" sizes="72x72" href="/cs-notes/icons/icon-72x72.png?v=edf3d310d67f8284a562bc3a58c3e761"/><link rel="apple-touch-icon" sizes="96x96" href="/cs-notes/icons/icon-96x96.png?v=edf3d310d67f8284a562bc3a58c3e761"/><link rel="apple-touch-icon" sizes="144x144" href="/cs-notes/icons/icon-144x144.png?v=edf3d310d67f8284a562bc3a58c3e761"/><link rel="apple-touch-icon" sizes="192x192" href="/cs-notes/icons/icon-192x192.png?v=edf3d310d67f8284a562bc3a58c3e761"/><link rel="apple-touch-icon" sizes="256x256" href="/cs-notes/icons/icon-256x256.png?v=edf3d310d67f8284a562bc3a58c3e761"/><link rel="apple-touch-icon" sizes="384x384" href="/cs-notes/icons/icon-384x384.png?v=edf3d310d67f8284a562bc3a58c3e761"/><link rel="apple-touch-icon" sizes="512x512" href="/cs-notes/icons/icon-512x512.png?v=edf3d310d67f8284a562bc3a58c3e761"/><link as="script" rel="preload" href="/cs-notes/webpack-runtime-5bb415d6ec02a3077fde.js"/><link as="script" rel="preload" href="/cs-notes/framework-a74044b4add31353c05b.js"/><link as="script" rel="preload" href="/cs-notes/app-3326c647442d9cdf5b1f.js"/><link as="script" rel="preload" href="/cs-notes/styles-6b8affa5cc22cb60670e.js"/><link as="script" rel="preload" href="/cs-notes/3925cf68b2c2d0cc1d85efad3e08a114191829f9-472ce0b777b01331616f.js"/><link as="script" rel="preload" href="/cs-notes/component---src-templates-notes-js-d8a721f12764927d7a7b.js"/><link as="fetch" rel="preload" href="/cs-notes/page-data/networking/transport-layer-protocols/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/cs-notes/page-data/app-data.json" crossorigin="anonymous"/><style data-linaria-critical="/networking/transport-layer-protocols"></style></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="ggj4icz"><div class="hug0csx"><header class="s11jhqd8"><div class="h2h01z2"><h5 class="hkd2pf6"><a class="h6fgol" href="/cs-notes/">CS Study Notes</a></h5></div></header></div><div class="s1p3sm64"><nav class="s1x3km3v" role="navigation"><legend></legend><ul><li><legend>Java</legend><ul><li><a href="/cs-notes/java/collection-framework">Java Collection Framework</a></li><li><a href="/cs-notes/java/io">I/O in Java</a></li><li><a href="/cs-notes/java/jmm">Java Memory Model (JMM)</a></li><li><a href="/cs-notes/java/jvm">Java Virtual Machine (JVM)</a></li><li><a href="/cs-notes/java/multithreading-concurrency">Multi-threading and Concurrency in Java</a></li></ul></li><li><a href="/cs-notes/k8s">Kubernetes (K8s)</a></li><li><a href="/cs-notes/mysql">MySQL</a></li><li><legend>Networking</legend><ul><li><a href="/cs-notes/networking/http">HTTP</a></li><li><a aria-current="page" class="" href="/cs-notes/networking/transport-layer-protocols">Transport Layer Protocols</a></li></ul></li><li><legend>Operating System</legend><ul><li><a href="/cs-notes/operating-system/file-system">File System</a></li><li><a href="/cs-notes/operating-system/inter-process-communication">Inter-process Communication</a></li><li><a href="/cs-notes/operating-system/memory-management">Memory Management</a></li><li><a href="/cs-notes/operating-system/process-and-thread">Process and thread</a></li></ul></li></ul></nav></div><div class="m1dsv0mj"><main class="c1swtufw"><div class="blog-post-container"><div class="blog-post"><h1>Transport Layer Protocols</h1><p>1 minutes ago</p><div class="blog-post-content"><h2>TCP</h2>
<p>TCP provides the abstraction of a reliable network running over an unreliable channel. Application layer can use the abstraction for messaging without worrying about lower level detail like: retransmission of lost data, in-order delivery etc. TCP is optimized for accurate delivery.</p>
<h3>TCP Segment</h3>
<p>The TCP segment consists of a segment header and</p>
<p>TCP header is the first 20 - 60 bytes of a TCP segment, it contains parameter and state of and end to end TCP socket.</p>
<h4>Header Structure</h4>
<p>The header fields are listed in order:</p>
<table>
<thead>
<tr>
<th>size</th>
<th>field</th>
<th>usage</th>
</tr>
</thead>
<tbody>
<tr>
<td>2 bytes</td>
<td>source port</td>
<td>sender's port number</td>
</tr>
<tr>
<td>2 bytes</td>
<td>destination port</td>
<td>reciever's port number</td>
</tr>
<tr>
<td>4 bytes</td>
<td>sequence number</td>
<td>2 roles: <ul><li>if SYN flag is 1, this is the initial squence number</li><li>if SYN flag is 0, this is the <strong>accumulated byte number</strong> for the current session.</li></ul></td>
</tr>
<tr>
<td>4 bytes</td>
<td>acknowledgement number</td>
<td>valid if ACK flag is set. This number indicate <strong>the next</strong> sequence number that the sender of the ACK is expecting. Acknoledge the receipt of all prior bytes (if any)</td>
</tr>
<tr>
<td>4 bits</td>
<td>data offest</td>
<td>the size of header, in number of 32-bit words. Minimum header size is 5 words (20 bytes) and maximum is 15 words (60 bytes), allowing up to 40 bytes of options in header. Use this offest to get the location of the actual data.</td>
</tr>
<tr>
<td>3 bits</td>
<td>reserved</td>
<td>for future use, should be set to 0</td>
</tr>
<tr>
<td>9 bits</td>
<td>flags</td>
<td>control flags, see below.</td>
</tr>
<tr>
<td>2 bytes</td>
<td>Window</td>
<td><code class="language-text">rwnd</code> size, indicating the number of packet the sender is currently willing to recieve (see <a href="#flow-control">Flow Control</a>)</td>
</tr>
<tr>
<td>2 bytes</td>
<td>Checksum</td>
<td>the Cyclic Redundancy Check (CRC) checksum. Calculated by sender. Used to verify data integrity. Reciever use this field to verify the data integrity and rejects the data if the check fails</td>
</tr>
<tr>
<td>2 bytes</td>
<td>Urgent pointer</td>
<td>offset from the sequence number indicating the last urgent data byte</td>
</tr>
<tr>
<td>0 - 40 bytes</td>
<td>Options</td>
<td>size is 0 to 10 32-bit words.</td>
</tr>
</tbody>
</table>
<h4>More on the flags</h4>
<table>
<thead>
<tr>
<th>flag</th>
<th>usage</th>
</tr>
</thead>
<tbody>
<tr>
<td>NS</td>
<td>TODO</td>
</tr>
<tr>
<td>CWR</td>
<td>TODO</td>
</tr>
<tr>
<td>ECE</td>
<td>TODO</td>
</tr>
<tr>
<td>URG flag</td>
<td>indicates that that the urgent pointer field is significant</td>
</tr>
<tr>
<td>ACK flag</td>
<td>used to indicate acknowledgement</td>
</tr>
<tr>
<td>RSH flag</td>
<td>used for TCP push. used primarily in streaming</td>
</tr>
<tr>
<td>RST flag</td>
<td>used to reset a TCP connection</td>
</tr>
<tr>
<td>SYN flag</td>
<td>used during 3-way handshake, to synchronize client and server</td>
</tr>
<tr>
<td>FIN flag</td>
<td>used during termination, indicates end of TCP connection</td>
</tr>
</tbody>
</table>
<h3>Reliable transmission</h3>
<ul>
<li>reordering: rearrange out of order message with sequence number</li>
<li>
<p>retransmission</p>
<ul>
<li>timeout-based retransmission: sender starts timer after it sends the packet.</li>
</ul>
</li>
<li>
<p>error detection</p>
<ul>
<li>CRC checksum</li>
</ul>
</li>
</ul>
<h3>3-Way Handshake</h3>
<p>All TCP connections begin with a three-way handshake. Before the client or the server can exchange any application data, they must agree on starting packet sequence numbers, as well as a number of other connection specific variables, from both sides:</p>
<ol>
<li>Client: SYN</li>
<li>Server: SYN + ACK</li>
<li>Client: ACK</li>
</ol>
<p>Once handshake is complete, application data can begin to flow between client and server.</p>
<blockquote>
<p><strong>Why do we need 3-way instead of 2-way ?</strong></p>
<p>A 2-way handshake can only make sure one party establish the initial sequence number (ISN). Since TCP is a bi-directional and fully duplex communication channel, we need a 3-way handshake to make sure both party establish the ISN.</p>
</blockquote>
<blockquote>
<p><strong>What if the last client ACK is lost?</strong></p>
<ul>
<li>On server side. When server send the SYN+ACK segment, the server-side TCP connection status becomse <code class="language-text">SYN_RECV</code>. The server will wait for timeout to retransmit the new SYN + ACK segment. The number of times to retry can be set by modifying <code class="language-text">/proc/sys/net/ipv4/tcp_synack_retries</code> on linux systems. If the server still doesn't recieve an ACK response, server will close the connection after some time.</li>
<li>On client side, if client proceed to send data and server is closing the connection, server will respond with <code class="language-text">RST</code>.</li>
</ul>
</blockquote>
<h3>4-Way Termination</h3>
<p>This is how the TCP connection is terminated</p>
<ol>
<li>Client: FIN</li>
<li>Server: ACK</li>
<li>Server: FIN</li>
<li>Client: ACK</li>
</ol>
<blockquote>
<p><strong>Note</strong>: After server recieve the last ACK from the client, the connection is terminated. However, the client does not immediately close the request. The client must wait for a 2MSL (Maximum Segment Life) time before terminating. This is to handle cases when the last ACK is not delivered to server. If the client imediatedly closed, it would leave the connection half-closed.</p>
</blockquote>
<blockquote>
<p>MSL is configurable, normally 60 seconds</p>
</blockquote>
<h3>Flow Control</h3>
<p>Ensures that sender will not overwhelm the reciever. Similar to <em>back pressure</em>, where the idea is to send feedback to the sender. TCP uses a sliding window (<code class="language-text">RWND</code>) to control the number of bytes in flight (i.e. the bytes sent but not yet <code class="language-text">ack</code>ed).</p>
<h4>WindowProbe</h4>
<h3>Congestion Control</h3>
<p>To avoid congestion collapse and achieve high performance. Use sliding window (<code class="language-text">CWND</code>).</p>
<ul>
<li>
<p>slow start phase (exponential increment)</p>
<ul>
<li>on each RTT</li>
</ul>
</li>
<li>
<p>congestion avoidance phase (when reach <code class="language-text">ssthresh</code>, additive increment)</p>
<ul>
<li>on each RTT</li>
</ul>
</li>
<li>
<p>congestion detection (multiplicative decrement, also change <code class="language-text">ssthresh</code>)</p>
<ul>
<li>on retransmission due to timeout</li>
</ul>
</li>
</ul>
<h3>TCP Optimization</h3>
<nav class="no-bullet">
<p>Reuse connection</p>
<ul>
<li>TODO:</li>
</ul>
<p>TCP Fast Open</p>
<ul>
<li>limited usecase.</li>
</ul>
<p>window scaling</p>
<ul>
<li><code class="language-text">sysctl -w net.inet.tcp.win_scale_factor=4</code></li>
</ul>
<p>increase intial congestion window</p>
<ul>
<li>Increasing the initial cwnd size on the server to the new RFC 6928 value of 10 segments (IW10) is one of the simplest ways to improve performance for all users and all applications running over TCP. For Linux, IW10 is the new default for all kernels above 2.6.39</li>
</ul>
<p>disable slow-start restart (SSR)</p>
<ul>
<li>
<p>TCP implements a slow-start restart(SSR) mechanism which resets the congestion window of a connection after it has been idle for a defined period of time. The setting can be disabled on Linux platforms:</p>
<ul>
<li><code class="language-text">sysctl -w net.ipv4.tcp_slow_start_after_idle=0</code></li>
</ul>
</li>
</ul>
</nav>
<h2>UDP</h2>
<h3>Difference with TCP</h3>
<ul>
<li>UDP is not reliable, it doesn't need to establish connection before transmitting data (unlike TCP handshake)</li>
<li>UDP is suitable for many real-time use-case like video streaming, voice call etc.</li>
<li>UDP is usually used for implementing of new protocols (e.g. QUIC)</li>
</ul>
<h3>UDP datagram</h3>
<h4>Datagram header structure</h4>
<table>
<thead>
<tr>
<th>size</th>
<th>field</th>
<th>usage</th>
</tr>
</thead>
<tbody>
<tr>
<td>2 bytes</td>
<td>Source port</td>
<td>sender's port number</td>
</tr>
<tr>
<td>2 bytes</td>
<td>Destination port</td>
<td>reciever's port number</td>
</tr>
<tr>
<td>2 bytes</td>
<td>Length</td>
<td>length of datagram <strong>in bytes</strong>, header + data</td>
</tr>
<tr>
<td>2 bytes</td>
<td>Checksum</td>
<td>checksum</td>
</tr>
</tbody>
</table>
<p>References</p>
<ul>
<li><a href="https://hpbn.co/building-blocks-of-tcp/">High Performance Browser Networking, Chapter 2 - Building Block of TCP</a></li>
<li><a href="https://tools.ietf.org/html/rfc793">RFC 793 TRANSMISSION CONTROL PROTOCOL</a></li>
<li><a href="https://en.wikipedia.org/wiki/Transmission_Control_Protocol">https://en.wikipedia.org/wiki/Transmission_Control_Protocol</a></li>
</ul></div></div></div></main></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/networking/transport-layer-protocols";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-3326c647442d9cdf5b1f.js"],"component---src-pages-404-js":["/component---src-pages-404-js-005d451c2fb3da42cb0f.js"],"component---src-pages-index-js":["/component---src-pages-index-js-b412d5317ae6b05c9f06.js"],"component---src-templates-notes-js":["/component---src-templates-notes-js-d8a721f12764927d7a7b.js"]};/*]]>*/</script><script src="/cs-notes/component---src-templates-notes-js-d8a721f12764927d7a7b.js" async=""></script><script src="/cs-notes/3925cf68b2c2d0cc1d85efad3e08a114191829f9-472ce0b777b01331616f.js" async=""></script><script src="/cs-notes/styles-6b8affa5cc22cb60670e.js" async=""></script><script src="/cs-notes/app-3326c647442d9cdf5b1f.js" async=""></script><script src="/cs-notes/framework-a74044b4add31353c05b.js" async=""></script><script src="/cs-notes/webpack-runtime-5bb415d6ec02a3077fde.js" async=""></script></body></html>